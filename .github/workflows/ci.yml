name: CI

on: [push, pull_request]

jobs:
  publish:
    name: CI for ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        name: [
            linux,
            windows,
            macos
        ]

        include:
          - name: linux
            os: ubuntu-latest
          - name: windows
            os: windows-latest
          - name: macos
            os: macos-latest

    steps:
      - uses: actions/checkout@v2

      - uses: actions-rs/toolchain@v1
        with:
          profile: minimal
          toolchain: stable

      - run: cargo build --all

      - name: (json_typegen_shared) cargo build --no-default-features
        run: cargo build --no-default-features
        working-directory: json_typegen_shared

      - run: cargo test --all

      - name: (json_typegen_demo) cargo run
        run: cargo run
        working-directory: json_typegen_demo

      - uses: actions/setup-node@v1
        with:
          node-version: '14.x'

      - run: npm ci
        working-directory: json_typegen_web
      - run: npm run build
        working-directory: json_typegen_web
